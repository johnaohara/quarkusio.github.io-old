<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->


</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a class="styled-logo" href="/">Quarkus</a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="grid-wrapper guides">
  <div class="grid__item width-12-12">
    <h1 class="text-caps">Quarkus - Writing JSON REST Services</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>JSON is now the <em>lingua franca</em> between microservices.</p>
</div>
<div class="paragraph">
<p>In this guide, we see how you can get your REST services to consume and produce JSON payloads.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>JDK 1.8+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.5.3+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application built in this guide is quite simple: the user can add elements in a list using a form and the list is updated.</p>
</div>
<div class="paragraph">
<p>All the information between the browser and the server are formatted as JSON.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/jbossas/protean-quickstarts.git" class="bare">https://github.com/jbossas/protean-quickstarts.git</a></code>, or download an <a href="https://github.com/jbossas/protean-quickstarts/archive/master.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>rest-json</code> <a href="https://github.com/jbossas/protean-quickstarts/tree/master/rest-json">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project">Creating the Maven project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn io.quarkus:quarkus-maven-plugin:1.0.0.Alpha1-SNAPSHOT:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=rest-json \
    -DclassName="org.acme.rest.json.FruitResource" \
    -Dpath="/fruits" \
    -Dextensions="resteasy-jsonb"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a Maven structure importing the RESTEasy/JAX-RS and JSON-B extensions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-your-first-json-rest-service">Creating your first JSON REST service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we will create an application to manage a list of fruits.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s create the <code>Fruit</code> bean as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme.rest.json;

import java.util.Objects;

public class Fruit {

    private String name;

    private String description;

    public Fruit() {
    }

    public Fruit(String name, String description) {
        this.name = name;
        this.description = description;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    @Override
    public boolean equals(Object obj) {
        if (!(obj instanceof Fruit)) {
            return false;
        }

        Fruit other = (Fruit) obj;

        return Objects.equals(other.name, this.name);
    }

    @Override
    public int hashCode() {
        return Objects.hash(this.name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nothing fancy. One important thing to note is that having a default constructor is required by the JSON serialization layer.</p>
</div>
<div class="paragraph">
<p>Now, edit the <code>org.acme.rest.json.FruitResource</code> class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme.rest.json;

import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Set;

import javax.ws.rs.Consumes;
import javax.ws.rs.DELETE;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class FruitResource {

    private Set&lt;Fruit&gt; fruits = Collections.newSetFromMap(Collections.synchronizedMap(new LinkedHashMap&lt;&gt;()));

    public FruitResource() {
        fruits.add(new Fruit("Apple", "Winter fruit"));
        fruits.add(new Fruit("Pineapple", "Tropical fruit"));
    }

    @GET
    public Set&lt;Fruit&gt; list() {
        return fruits;
    }

    @POST
    public Set&lt;Fruit&gt; add(Fruit fruit) {
        fruits.add(fruit);
        return fruits;
    }

    @DELETE
    public Set&lt;Fruit&gt; delete(Fruit fruit) {
        fruits.remove(fruit);
        return fruits;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation is pretty straightforward and you just need to define your endpoints using the JAX-RS annotations.</p>
</div>
<div class="paragraph">
<p>The <code>Fruit</code> objects will be automatically serialized/deserialized by <a href="http://json-b.net/">JSON-B</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>While RESTEasy supports auto-negotiation, when using Quarkus, it is very important to define the <code>@Produces</code> and <code>@Consumes</code> annotations.
They are analyzed at build time and Quarkus restricts the number of JAX-RS providers included in the native image to the minimum required by the application.
It allows to reduce the size of the native image.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-frontend">Creating a frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to interact with our <code>FruitResource</code>.
Quarkus automatically serves static resources located under the <code>META-INF/resources</code> directory.
In the <code>src/main/resources/META-INF/resources</code> directory, add a <code>fruits.html</code> file with the content from this <a href="https://github.com/jbossas/protean-quickstarts/blob/master/rest-json/src/main/resources/META-INF/resources/fruits.html">fruits.html</a> file in it.</p>
</div>
<div class="paragraph">
<p>You can now interact with your REST service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>start Quarkus with <code>mvn compile quarkus:dev</code></p>
</li>
<li>
<p>open a browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code></p>
</li>
<li>
<p>add new fruits to the list via the form</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-a-native-image">Building a native image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can build a native image with the usual command <code>mvn package -Pnative</code>.</p>
</div>
<div class="paragraph">
<p>Running it is as simple as executing <code>./target/rest-json-1.0-SNAPSHOT-runner</code>.</p>
</div>
<div class="paragraph">
<p>You can then point your browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code> and use your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-serialization">About serialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The library we use to serialize Java objects to JSON documents is <a href="http://json-b.net/">JSON-B</a>.
It uses Java reflection to get the properties of an object and serialize them.</p>
</div>
<div class="paragraph">
<p>Most likely, you have understood already that using native images requires you to register the usage of reflection.</p>
</div>
<div class="paragraph">
<p>So far, we haven&#8217;t registered any class, even not <code>Fruit</code>, for reflection usage.
However everything is working fine.</p>
</div>
<div class="paragraph">
<p>The fact is that Quarkus performs some magic when it is capable of inferring the serialized types from the REST methods.</p>
</div>
<div class="paragraph">
<p>When you have the following REST method, it is fairly easy to determine that <code>Fruit</code> will be serialized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JAVA" data-lang="JAVA">@GET
@Produces("application/json")
public List&lt;Fruit&gt; list() {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkus does that for you automatically by analyzing the REST methods at build time
and that&#8217;s why we didn&#8217;t need any reflection registration in the first part of this guide.</p>
</div>
<div class="paragraph">
<p>Another common pattern in the JAX-RS world is to use the <code>Response</code> object.
<code>Response</code> comes with some nice perks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>you can return different entity types depending on what happens in your method (a <code>Legume</code> or an <code>Error</code> for instance);</p>
</li>
<li>
<p>you can set the attributes of the <code>Response</code> (the status comes to mind in the case of an error).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your REST method then looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JAVA" data-lang="JAVA">@GET
@Produces("application/json")
public Response list() {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can imagine, it is not possible for Quarkus to determine at build time the type included in the <code>Response</code> as the information is not available.</p>
</div>
<div class="paragraph">
<p>In this case, Quarkus won&#8217;t be able to automatically register for reflection the required classes.</p>
</div>
<div class="paragraph">
<p>This leads us to our next section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-response">Using Response</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s create the <code>Legume</code> class which will be serialized as JSON, following the same model as for our <code>Fruit</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JAVA" data-lang="JAVA">package org.acme.rest.json;

import java.util.Objects;

public class Legume {

    private String name;

    private String description;

    public Legume() {
    }

    public Legume(String name, String description) {
        this.name = name;
        this.description = description;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    @Override
    public boolean equals(Object obj) {
        if (!(obj instanceof Legume)) {
            return false;
        }

        Legume other = (Legume) obj;

        return Objects.equals(other.name, this.name);
    }

    @Override
    public int hashCode() {
        return Objects.hash(this.name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create a <code>LegumeResource</code> REST service with only one method which returns the list of legumes.</p>
</div>
<div class="paragraph">
<p>This method returns a <code>Response</code> and not a list of <code>Legume</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JAVA" data-lang="JAVA">package org.acme.rest.json;

import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Set;

import javax.ws.rs.Consumes;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

@Path("/legumes")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class LegumeResource {

    private Set&lt;Legume&gt; legumes = Collections.newSetFromMap(Collections.synchronizedMap(new LinkedHashMap&lt;&gt;()));

    public LegumeResource() {
        legumes.add(new Legume("Carrot", "Root vegetable, usually orange"));
        legumes.add(new Legume("Zucchini", "Summer squash"));
    }

    @GET
    public Response list() {
        return Response.ok(legumes).build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to display our list of legumes.
In the <code>src/main/resources/META-INF/resources</code> directory, add a <code>legumes.html</code> file with the content from this <a href="https://raw.githubusercontent.com/jbossas/quarkus-quickstarts/master/rest-json/src/main/resources/META-INF/resources/legumes.html">legumes.html</a> file in it.</p>
</div>
<div class="paragraph">
<p>Open a browser to <a href="http://localhost:8080/legumes.html" class="bare">http://localhost:8080/legumes.html</a> and you will see our list of legumes.</p>
</div>
<div class="paragraph">
<p>The interesting part starts when running the application as a native image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create the native image with <code>mvn package -Pnative</code>.</p>
</li>
<li>
<p>execute it with <code>./target/rest-json-1.0-SNAPSHOT-runner</code></p>
</li>
<li>
<p>open a browser and go to <a href="http://localhost:8080/legumes.html" class="bare">http://localhost:8080/legumes.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No legumes there.</p>
</div>
<div class="paragraph">
<p>As mentioned above, the issue is that Quarkus was not able to determine the <code>Legume</code> class will require some reflection by analyzing the REST endpoints.
JSON-B tries to get the list of fields of <code>Legume</code> and gets an empty list so it does not serialize the fields' data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>At the moment, when JSON-B tries to get the list of fields of a class, if the class is not registered for reflection, no exception will be thrown.
GraalVM will simply return an empty list of fields.</p>
</div>
<div class="paragraph">
<p>Hopefully, this will change in the future and make the error more obvious.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can register <code>Legume</code> for reflection manually by adding the <code>@RegisterForReflection</code> annotation on our <code>Legume</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JAVA" data-lang="JAVA">@RegisterForReflection
public class Legume {
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s do that and follow the same steps as before:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hit <code>Ctrl+C</code> to stop the application</p>
</li>
<li>
<p>create the native image with <code>mvn package -Pnative</code>.</p>
</li>
<li>
<p>execute it with <code>./target/rest-json-1.0-SNAPSHOT-runner</code></p>
</li>
<li>
<p>open a browser and go to <a href="http://localhost:8080/legumes.html" class="bare">http://localhost:8080/legumes.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This time, you can see our list of legumes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating JSON REST services with Quarkus is easy as it relies on proven and well known technologies.</p>
</div>
<div class="paragraph">
<p>As usual, Quarkus further simplifies things under the hood when running your application as a native image.</p>
</div>
<div class="paragraph">
<p>There is only one thing to remember: if you use <code>Response</code> and Quarkus can&#8217;t determine the beans that are serialized, you need to annotate them with <code>@RegisterForReflection</code>.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/" class="styled-logo">Quarkus</a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse Microprofile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="http://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/RHLogo_white.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
