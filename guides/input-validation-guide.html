<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->


</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a class="styled-logo" href="/">Quarkus</a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="grid-wrapper guides">
  <div class="grid__item width-12-12">
    <h1 class="text-caps">Quarkus - Input Validation and REST Services</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide covers how to use Hibernate Validator/Bean Validation in your REST services.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>JDK 1.8+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.5.3+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application built in this guide is quite simple. The user fills a form on a web page.
The web page sends the form content to the <code>BookResource</code> as JSON (using Ajax). The <code>BookResource</code> validates the user input and returns the
<em>result</em> as JSON.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/guides/images/validation-guide-architecture.png" alt="Architecture" width="640" height="480"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/jbossas/protean-quickstarts.git" class="bare">https://github.com/jbossas/protean-quickstarts.git</a></code>, or download an <a href="https://github.com/jbossas/protean-quickstarts/archive/master.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>input-validation</code> <a href="https://github.com/jbossas/protean-quickstarts/tree/master/input-validation">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project">Creating the Maven project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new project. Create a new project with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn io.quarkus:quarkus-maven-plugin:1.0.0.Alpha1-SNAPSHOT:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=input-validation \
    -DclassName="org.acme.validation.BookResource" \
    -Dpath="/books" \
    -Dextensions="resteasy-jsonb, hibernate-validator"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a Maven structure importing the RESTEasy/JAX-RS, JSON-B and Hibernate Validator/Bean Validation extensions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-the-validator">Accessing the Validator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Edit the <code>org.acme.validation.BookResource</code> class, and inject the <code>Validator</code> object as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
Validator validator;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Validator</code> allows checking constraints on a specific object.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="constraints">Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this application, we are going to test an elementary object, but we support complicated constraints and can validate graphs of objects.
Create the <code>org.acme.validation.Book</code> class with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme.validation;

import javax.validation.constraints.*;

public class Book {

    @NotBlank(message="Title may not be blank")
    private String title;

    @NotBlank(message="Author may not be blank")
    private String author;

    @Min(message="Author has been very lazy", value=1)
    private double pages;

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public String getAuthor() {
        return author;
    }

    public void setAuthor(String author) {
        this.author = author;
    }

    public double getPages() {
        return pages;
    }

    public void setPages(double pages) {
        this.pages = pages;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constraints are added on fields, and when an object is validated, the values are checked.
The getter and setter methods are also used for JSON mapping.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-mapping-and-validation">JSON mapping and validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Back to the <code>BookResource</code> class.
Add the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/manual-validation")
@POST
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public Result tryMeManualValidation(Book book) {
    Set&lt;ConstraintViolation&lt;Book&gt;&gt; violations = validator.validate(book);
    if (violations.isEmpty()) {
        return new Result("Book is valid! It was validated by manual validation.");
    } else {
        return new Result(violations);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yes it does not compile, <code>Result</code> is missing, but we will add it very soon.</p>
</div>
<div class="paragraph">
<p>The method parameter (<code>book</code>) is created from the JSON payload automatically.</p>
</div>
<div class="paragraph">
<p>The method uses the <code>Validator</code> to check the payload.
It returns a set of violations.
If this set is empty, it means the object is valid.
In case of failures, the messages are concatenated and sent back to the browser.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s now create the <code>Result</code> class as an inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">private class Result {

    Result(String message) {
        this.success = true;
        this.message = message;
    }

    Result(Set&lt;? extends ConstraintViolation&lt;?&gt;&gt; violations) {
        this.success = false;
        this.message = violations.stream()
             .map(cv -&gt; cv.getMessage())
             .collect(Collectors.joining(", "));
    }

    private String message;
    private boolean success;

    public String getMessage() {
        return message;
    }

    public boolean isSuccess() {
        return success;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class is very simple and only contains 2 fields and the associated getters and setters.
Because we indicate that we produce JSON, the mapping to JSON is made automatically.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rest-end-point-validation">REST end point validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While using the <code>Validator</code> manually might be useful for some advanced usage,
if you simply want to validate the parameters or the return value or your REST end point,
you can annotate it directly, either with constraints (<code>@NotNull</code>, <code>@Digits</code>&#8230;&#8203;)
or with <code>@Valid</code> (which will cascade the validation to the bean).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create an end point validating the <code>Book</code> provided in the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/end-point-method-validation")
@POST
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public Result tryMeEndPointMethodValidation(@Valid Book book) {
    return new Result("Book is valid! It was validated by end point method validation.");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we don&#8217;t have to manually validate the provided <code>Book</code> anymore as it is automatically validated.</p>
</div>
<div class="paragraph">
<p>If a validation error is triggered, a violation report is generated and serialized as JSON as our end point produces a JSON output.
It can be extracted and manipulated to display a proper error message.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="service-method-validation">Service method validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It might not always be handy to have the validation rules declared at the end point level as it could duplicate some business validation.</p>
</div>
<div class="paragraph">
<p>The best option is then to annotate a method of your business service with your constraints (or in our particular case with <code>@Valid</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme.validation;

import javax.enterprise.context.ApplicationScoped;
import javax.validation.Valid;

@ApplicationScoped
public class BookService {

    public void validateBook(@Valid Book book) {
        // your business logic here
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the service in your rest end point triggers the <code>Book</code> validation automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject BookService bookService;

@Path("/service-method-validation")
@POST
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public Result tryMeServiceMethodValidation(Book book) {
    try {
        bookService.validateBook(book);
        return new Result("Book is valid! It was validated by service method validation.");
    } catch (ConstraintViolationException e) {
        return new Result(e.getConstraintViolations());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, if you want to push the validation errors to the frontend, you have to catch the exception and push the information yourselves
as they will not be automatically pushed to the JSON output.</p>
</div>
<div class="paragraph">
<p>Keep in mind that you usually don&#8217;t want to expose to the public the internals of your services
- and especially not the validated value contained in the violation object.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-frontend">A frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add the simple web page to interact with our <code>BookResource</code>.
Quarkus automatically serves static resources contained in the <code>META-INF/resources</code> directory.
In the <code>src/main/resources/META-INF/resources</code> directory, replace the <code>index.html</code> file with the content from this <a href="https://github.com/jbossas/protean-quickstarts/blob/master/input-validation/src/main/resources/META-INF/resources/index.html">index.html</a> file in it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run-the-application">Run the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, let&#8217;s see our application in action. Run it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn compile quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, open your browser to <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the book details (valid or invalid)</p>
</li>
<li>
<p>Click on the <em>Try me&#8230;&#8203;</em> buttons to check if your data is valid using one of the methods we presented above.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="/guides/images/validation-guide-screenshot.png" alt="Application" width="800"></span></p>
</div>
<div class="paragraph">
<p>As usual, the application can be packaged using <code>mvn clean package</code> and executed using the <code>-runner.jar</code> file.
You can also build the native executable using <code>mvn package -Pnative</code>.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/" class="styled-logo">Quarkus</a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse Microprofile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="http://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/RHLogo_white.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
