<!DOCTYPE html>
<html>

<head>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NJWS5L');</script>
  <!-- End Google Tag Manager -->


</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a class="styled-logo" href="/">Quarkus</a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="/extensions/" class="">Extensions</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="grid-wrapper guides">
  <div class="grid__item width-12-12">
    <h1 class="text-caps">Getting Started Knative Guide</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide covers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The deployment of the application to Kubernetes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide takes as input the application developed in the <a href="building-native-image-guide.html">native application guide</a>.
So, you should have been able to package your application as a binary executable, copied it in a Docker image and run this image.</p>
</div>
<div class="paragraph">
<p>Depending on whether you are a <em>bare</em> Kubernetes user or an OpenShift user, pick the section you need.
The OpenShift section leverages OpenShift build and route features which are not available in <em>bare</em> Kubernetes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this guide you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>roughly 20 minutes</p>
</li>
<li>
<p>having access to a Kubernetes and/or OpenShift cluster. Minikube and Minishift are valid options.</p>
</li>
<li>
<p>having deployed Knative components on <a href="https://github.com/knative/docs/blob/master/install/Knative-with-Minikube.md">Minikube</a>
or <a href="https://github.com/openshift-cloud-functions/Documentation/blob/master/knative-minishift.md">Minishift</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember, you need to configure Maven as indicated in the <a href="maven-config.html">Maven configuration page</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend to follow the instructions in the next sections and build the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/jbossas/protean-quickstarts.git" class="bare">https://github.com/jbossas/protean-quickstarts.git</a></code>, or download an <a href="https://github.com/jbossas/protean-quickstarts/archive/master.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>getting-started-knative</code> directory.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-the-application-in-knative">Deploying the application in Knative</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we deploy the application to Knative in Minikube or Minishift we need to create the following Kubernetes objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/knative/docs/tree/master/serving/samples/build-private-repo-go#creating-a-dockerhub-push-credential">Container registry secrets</a> :-
This is required to for the built container image to be pushed to the container registry of your choice</p>
</li>
<li>
<p><a href="https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys">Deploy Key</a> :-
This is required only if you are going to pull the sources from private repository.</p>
</li>
<li>
<p><a href="https://github.com/knative/docs/tree/master/serving/samples/build-private-repo-go#setting-up-our-build-service-account">Build Service Account</a> :-
The Kubernetes Service Account that will have access to Container Registry secret and Deploy Key secret</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are not using private GitHub repo then you dont need the <code>Deploy Key</code> created and added to the Build Service Account</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the following commands to kick start <a href="https://github.com/knative/build">Knative Build</a> which will build the quarkus application container image
using Dockerfile and <a href="https://github.com/GoogleContainerTools/kaniko">Kaniko</a>.  After a successful build you will have the
Knative serving application deployed with the built container image.  You can watch the application build pods using the
command <code>kubectl get pods -w</code>. You can terminate the watch using the command <span class="keyseq"><kbd>CTRL</kbd>+<kbd>c</kbd></span></p>
</div>
<div class="paragraph">
<p>Since there are some parameters that you need to pass to the builds, which are right now configurable via maven properties,
you need to run the following maven command to make them passed to the Knative resource yamls.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Maven Parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Use</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">github.deploy.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the base64 encoded private key that is configured to be used as the GitHub private repo Deploy key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cat ~/.ssh/quarkus-quickstarts | base64 -w 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">github.keyscan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the base64 encoded value of <code>ssh-keyscan github.com</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssh-keyscan github.com | base64 -w 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container.registry.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the container registry url, NOTE: this should be a v2 container registry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://index.docker.io/v1/" class="bare">https://index.docker.io/v1/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container.registry.user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user name to authenticate with the container registry</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container.registry.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user password to authenticate with the container registry</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">git.source.revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The revision of the source to checkout from GitHub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">git.source.repo.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The GitHub repo url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/jbossas/protean-quickstarts.git" class="bare">https://github.com/jbossas/protean-quickstarts.git</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">app.container.image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified name of the container image that will be pushed to the container registry after build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker.io/demo/quarkus-knative-quickstart</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following is the example command to generate the need knative resource files</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">mvn -Dgithub.deploy.key=$(cat ~/.ssh/quarkus-quickstarts | base64 -w 0) \
    -Dgithub.keyscan=$(ssh-keyscan github.com | base64 -w 0) \
    -Dcontainer.registry.url='https://quay.io/v2' \
    -Dcontainer.registry.user='demo' \
    -Dcontainer.registry.password='password' \
    -Dgit.source.revision='master' \
    -Dgit.source.repo.url='https://github.com/jbossas/protean-quickstarts.git' \ #<1>
    -Dapp.container.image='docker.io/demo/getting-started-knative' \
    clean process-resources</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If your are using a private repo then you might need to use git ssh url</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above command will apply the property values to the Knative resources found in <code>${project.basedir}/src/main/knative</code>
and copy them to <code>${project.build.directory}/knative</code></p>
</div>
<div class="paragraph">
<p>Run the following command to create the Knative resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply --recursive --filename target/knative</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-your-application">Accessing your application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The application is now exposed as an internal service. If you are using <code>minikube</code> or <code>minishift</code>, you can access it using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">INGRESSGATEWAY=istio-ingressgateway
IP_ADDRESS="$(minikube ip):$(kubectl get svc $INGRESSGATEWAY --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')" <b class="conum">(1)</b>

curl -v -H 'Host: getting-started-knative.example.com' $IP_ADDRESS/hello/greeting/redhat</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>you can replace <code>minikube ip</code> with <code>minishift ip</code> if you are using OpenShift</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="going-further">Going further</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide covered the deployment of a Quarkus application as Knative application on Kubernetes
However, there is much more, and the integration with these environments has been tailored to make Quarkus applications execution very smooth.
For instance, the health extension can be used for health check; the configuration support allows mounting the application configuration using config map, the metric extension produces data <em>scrappable</em> by Prometheus and so on.</p>
</div>
</div>
</div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/" class="styled-logo">Quarkus</a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse Microprofile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="http://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/RHLogo_white.svg"></a>
    </span>
  </div>
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript">
    if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
        _satellite.pageBottom();
    }
  </script>
</body>

</html>
